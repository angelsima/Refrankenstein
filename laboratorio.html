<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Refr√°nkenstein - Creativo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      touch-action: pan-y;
    }
    .title-container {
      text-align: center;
      margin-bottom: 30px;
    }
    .modo-container {
      text-align: center;
      margin-bottom: 30px;
    }
    .modo-selector {
      display: flex;
      justify-content: center;
      gap: 15px;
    }
    .modo-btn {
      padding: 10px 20px;
      border: 2px solid #2c3e50;
      border-radius: 30px;
      background: white;
      cursor: pointer;
      font-size: 1em;
      transition: all 0.3s;
    }
    .modo-btn.activo {
      background: #2c3e50;
      color: white;
    }
    .modo-contenido {
      display: none;
    }
    .modo-contenido.activo {
      display: block;
    }
    .grupo-combinacion {
      background: #f5f5f5;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    .selector-tipo,
    .selector-contenido {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
    }
    select {
      width: 48%;
      padding: 8px;
      border: 2px solid #bdc3c7;
      border-radius: 5px;
    }
    .boton-generar {
      font-size: 2em;
      background: none;
      border: none;
      cursor: pointer;
      color: #2c3e50;
      display: block;
      margin: 0 auto;
    }
    .resultado {
      font-size: 24px;
      padding: 20px;
      border: 2px dashed #bdc3c7;
      border-radius: 10px;
      margin-top: 20px;
      text-align: center;
      background: #fff;
    }
    .notificacion {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #27ae60;
      color: white;
      padding: 12px 24px;
      border-radius: 25px;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16);
      display: none;
      animation: slideUp 0.3s ease-out;
    }
    @keyframes slideUp {
      from {
        bottom: -50px;
      }
      to {
        bottom: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="menu-flotante">
    <button class="menu-btn">‚ò∞</button>
    <div class="menu-contenido">
        <div class="menu-grupo">
            <div class="menu-titulo">Modos de juego</div>
            <a href="index.html" class="activo">Random</a>
            <a href="laboratorio1.html">Laboratorio</a>
            <a href="tradicional.html">Tradicional</a>
        </div>
        <div class="menu-grupo">
            <a href="publicos.html">Leer refrankensteins</a>
            <a href="about.html">¬øQu√© es Refr√°nkenstein?</a>
        </div>
    </div>
</div>
  <div class="title-container">
    <h1>Refr√°nkenstein</h1>
    <h5>¬°Reinventa el refranero!</h5>
  </div>

  <div class="modo-container">
    <div class="modo-selector">
      <button class="modo-btn activo" onclick="mostrarModo('random')">üé≤ Random</button>
      <button class="modo-btn" onclick="mostrarModo('laboratorio')">üî¨ Laboratorio</button>
    </div>
  </div>

  <!-- RANDOM -->
           <div class="inicio-container">
        <button class="change-inicio" onclick="cambiarInicio()">‚Üª</button>
        <div id="inicio-refran" class="inicio-texto"></div>
    </div>

    <div class="swipe-container">
        <button class="nav-arrow prev" onclick="previousRemate()">‚ùÆ</button>
        <button class="nav-arrow next" onclick="nextRemate()">‚ùØ</button>
        <div class="remate-card" id="remate-card"></div>
    </div>

    <button class="heart-button" onclick="toggleLike()">üß™</button>

  <!-- LABORATORIO -->
  <div id="modo-laboratorio" class="modo-contenido">
    <div class="grupo-combinacion">
      <div class="selector-tipo">
        <select id="tipo-parte-1" onchange="actualizarContenido(1)">
          <option value="inicio" selected>Inicio</option>
          <option value="remate">Remate</option>
        </select>
        <select id="tipo-parte-2" onchange="actualizarContenido(2)">
          <option value="inicio">Inicio</option>
          <option value="remate" selected>Remate</option>
        </select>
      </div>
      <div class="selector-contenido">
        <select id="contenido-parte-1" size="5"></select>
        <select id="contenido-parte-2" size="5"></select>
      </div>
      <button class="boton-generar" onclick="generarRefran()">üß™</button>
      <div class="resultado" id="resultado-lab"></div>
    </div>
  </div>

  <div class="notificacion" id="notificacion">Guardado</div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAdoPUF-cCyvpfiCJiBfCRv3ZYtwu1W4tc",
      authDomain: "refrankenstein.firebaseapp.com",
      projectId: "refrankenstein",
      storageBucket: "refrankenstein.firebasestorage.app",
      messagingSenderId: "575434538832",
      appId: "1:575434538832:web:615f850a61c54ddd9d3655"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let inicios = [], remates = [];

    function eliminarDuplicados(arr) {
      const vistos = new Set();
      return arr.filter(item => {
        const normalizado = item.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu, "").trim();
        return vistos.has(normalizado) ? false : vistos.add(normalizado);
      });
    }

    async function cargarDatos() {
      const snapshot = await db.collection("tradicionales").get();
      const tempInicios = [], tempRemates = [];

      snapshot.forEach(doc => {
        const data = doc.data();
        if (data.inicio) tempInicios.push(data.inicio.trim());
        if (data.remate) tempRemates.push(data.remate.trim());
      });

      inicios = eliminarDuplicados(tempInicios).sort((a, b) => a.localeCompare(b, 'es'));
      remates = eliminarDuplicados(tempRemates).sort((a, b) => a.localeCompare(b, 'es'));

      actualizarContenido(1);
      actualizarContenido(2);
      generarRandom();
    }

    function actualizarContenido(parte) {
      const tipo = document.getElementById(`tipo-parte-${parte}`).value;
      const select = document.getElementById(`contenido-parte-${parte}`);
      const datos = tipo === "inicio" ? inicios : remates;
      select.innerHTML = datos.map((d, i) => `<option value="${i}">${d}</option>`).join("");
    }

    function mostrarNotificacion(mensaje = "¬°Guardado!", duracion = 2000) {
      const n = document.getElementById("notificacion");
      n.textContent = mensaje;
      n.style.display = "block";
      setTimeout(() => n.style.display = "none", duracion);
    }

    function generarRandom() {
      const inicio = inicios[Math.floor(Math.random() * inicios.length)] || "";
      const remate = remates[Math.floor(Math.random() * remates.length)] || "";
      document.getElementById("resultado-random").textContent = `${inicio} ${remate}`;
    }

    async function guardarRefran(completo) {
      const [inicio, ...resto] = completo.split(" ");
      const remate = resto.join(" ");
      const existe = await db.collection("tradicionales")
        .where("inicio", "==", inicio)
        .where("remate", "==", remate)
        .get();

      if (!existe.empty) {
        mostrarNotificacion("Es un refr√°n tradicional");
        return;
      }

      await db.collection("refranes").add({
        texto: completo,
        fecha: firebase.firestore.FieldValue.serverTimestamp(),
        votos: 0
      });

      mostrarNotificacion("¬°Refr√°nkenstein guardado!");
    }

    function generarRefran() {
      const tipo1 = document.getElementById("tipo-parte-1").value;
      const tipo2 = document.getElementById("tipo-parte-2").value;
      const idx1 = +document.getElementById("contenido-parte-1").value;
      const idx2 = +document.getElementById("contenido-parte-2").value;
      const parte1 = tipo1 === "inicio" ? inicios[idx1] : remates[idx1];
      const parte2 = tipo2 === "inicio" ? inicios[idx2] : remates[idx2];
      const combinado = `${parte1} ${parte2}`;
      document.getElementById("resultado-lab").textContent = combinado;
      guardarRefran(combinado);
    }

    function mostrarModo(modo) {
      document.querySelectorAll(".modo-btn").forEach(btn => btn.classList.remove("activo"));
      document.querySelector(`[onclick="mostrarModo('${modo}')"]`).classList.add("activo");
      document.querySelectorAll(".modo-contenido").forEach(div => div.classList.remove("activo"));
      document.getElementById(`modo-${modo}`).classList.add("activo");
    }

    document.addEventListener("DOMContentLoaded", cargarDatos);
    function cambiarInicio() {
    if(iniciosRefran.length === 0) return;
    inicioActual = iniciosRefran[Math.floor(Math.random() * iniciosRefran.length)];
    document.getElementById('inicio-refran').textContent = inicioActual;
    generarNuevoRemate();
}

        function generarNuevoRemate() {
            if(rematesRefran.length === 0) return;
            const nuevoRemate = rematesRefran[Math.floor(Math.random() * rematesRefran.length)];
            remateHistory = remateHistory.slice(0, currentIndex + 1);
            remateHistory.push(nuevoRemate);
            currentIndex++;
            actualizarRemate();
        }

        function actualizarRemate() {
            const card = document.getElementById('remate-card');
            card.textContent = remateHistory[currentIndex];
            actualizarCorazon();
        }

       async function toggleLike() {
    const combination = `${inicioActual} ${remateHistory[currentIndex]}`;
    const heart = document.querySelector('.heart-button');
	        // Verificar si es un refr√°n tradicional
    const esTradicional = await esRefranTradicional(inicioActual, remateHistory[currentIndex]);
    
    if(esTradicional) {
        showToast("¬°Este es un refr√°n tradicional! Usa otro", 3000);
        return;
    }
  </script>
</body>
</html>
