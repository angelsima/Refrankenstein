<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RefrÃ¡nkenstein - Laboratorio</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      touch-action: pan-y;
    }
    .title-container {
      text-align: center;
      margin-bottom: 80px;
    }
    .modo-container {
      text-align: center;
      margin-bottom: 0px;
    }
    
    /* Estilos del menÃº */
    .menu-flotante {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 1000;
    }
    .menu-btn {
      background: #2c3e50;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
      border: none;
    }
    .menu-contenido {
      display: none;
      position: absolute;
      background-color: #f9f9f9;
      min-width: 160px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      border-radius: 12px;
      padding: 10px 0;
      border: none;
    }
    .menu-contenido a {
      display: block;
      padding: 8px 16px;
      text-decoration: none;
      color: #333;
    }
    .menu-contenido a.activo {
      font-weight: bold;
      background: #eee;
    }
    .menu-contenido a:hover {
      background: #ddd;
    }
    
    /* Estilos del Laboratorio */
    .laboratorio {
      max-width: 800px;
      margin: 70px auto 20px;
      padding: 20px;
    }
    .grupo-combinacion {
      background: #f5f5f5;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    .selector-tipo {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
    }
    .selector-tipo select {
      width: 48%;
      padding: 8px;
      border: 2px solid #bdc3c7;
      border-radius: 5px;
    }
    .selector-contenido {
      display: flex;
      justify-content: space-between;
    }
    /* Los select que simulan la ruleta */
    .selector-contenido select {
      width: 48%;
      padding: 8px;
      border: 2px solid #bdc3c7;
      border-radius: 5px;
      margin-bottom: 15px;
      height: 150px; /* para mostrar 5 elementos aproximadamente */
      overflow-y: scroll;
    }
    .boton-generar {
      font-size: 2em;
      background: none;
      border: none;
      cursor: pointer;
      color: #ccc;
      display: block;
      margin: 0 auto;
    }
    .boton-generar:hover {
      background: #2980b9;
    }
    .resultado {
      font-size: 24px;
      padding: 20px;
      border: 2px dashed #bdc3c7;
      border-radius: 10px;
      margin-top: 20px;
      text-align: center;
      background: #fff;
    }
    .notificacion {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #27ae60;
      color: white;
      padding: 12px 24px;
      border-radius: 25px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.16);
      display: none;
      animation: slideUp 0.3s ease-out;
    }
    @keyframes slideUp {
      from { bottom: -50px; }
      to { bottom: 20px; }
    }
    .floating-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #2c3e50;
      color: white;
      padding: 12px 20px;
      border-radius: 50px;
      text-decoration: none;
      text-align: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      z-index: 1000;
      font-size: 0.9em;
      transition: all 0.3s;
    }
    .floating-button:hover {
      background: #1a252f;
      transform: translateY(-3px);
    }
  </style>
</head>
<body>
  <!-- MenÃº -->
  <div class="menu-flotante">
    <button class="menu-btn">â˜°</button>
    <div class="menu-contenido">
      <div class="menu-grupo">
        <div class="menu-titulo">Modos de juego</div>
        <a href="index.html" class="activo">Random</a>
        <a href="laboratorio.html">Laboratorio</a>
        <a href="tradicional.html">Tradicional</a>
      </div>
      <div class="menu-grupo">
        <div class="menu-titulo">Otras secciones</div>
        <a href="publicos.html">Leer refrankensteins</a>
        <a href="about.html">Â¿QuÃ© es RefrÃ¡nkenstein?</a>
      </div>
    </div>
  </div>

  <div class="title-container">
    <h1>RefrÃ¡nkenstein</h1>
    <h5>Â¡Reinventa el refranero!</h5>
  </div>
  
  <div class="modo-container">
    <h2>Modo Laboratorio</h2>
  </div>

  <!-- Laboratorio -->
  <div class="laboratorio">
    <div class="grupo-combinacion">
      <div class="selector-tipo">
        <select id="tipo-parte-1" onchange="actualizarContenido(1)">
          <option value="inicio" selected>Inicio</option>
          <option value="remate">Remate</option>
        </select>
        <select id="tipo-parte-2" onchange="actualizarContenido(2)">
          <option value="inicio">Inicio</option>
          <option value="remate" selected>Remate</option>
        </select>
      </div>
      
      <div class="selector-contenido">
        <select id="contenido-parte-1" size="5" onchange="centrarSelect(this)"></select>
        <select id="contenido-parte-2" size="5" onchange="centrarSelect(this)"></select>
      </div>
      
      <button class="boton-generar" onclick="generarRefran()">
        ðŸ§ª
      </button>
    </div>
    
    <div class="resultado" id="resultado"></div>
  </div>
  <div class="notificacion" id="notificacion">Â¡RefrÃ¡n guardado!</div>

  <a href="publicos.html" class="floating-button">
    ðŸ“œ RefrÃ¡nkensteins creados â†’
  </a>

  <!-- Firebase + Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js" defer></script>
  <!-- Usar la URL de unpkg para PickerWheel -->
  <script src="https://unpkg.com/pickerwheel@1.0.2/dist/pickerwheel.min.js" defer></script>
  <script defer>
    // FunciÃ³n para centrar el select de modo que el elemento seleccionado quede en el centro
    function centrarSelect(selectElement) {
      const selectedIndex = selectElement.selectedIndex;
      // Suponiendo que cada opciÃ³n tiene una altura constante:
      const optionHeight = selectElement.scrollHeight / selectElement.options.length;
      // Coloca el elemento seleccionado en la posiciÃ³n central (aproximadamente)
      selectElement.scrollTop = (selectedIndex - Math.floor(selectElement.size / 2)) * optionHeight;
    }

    // ConfiguraciÃ³n de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAdoPUF-cCyvpfiCJiBfCRv3ZYtwu1W4tc",
      authDomain: "refrankenstein.firebaseapp.com",
      projectId: "refrankenstein",
      storageBucket: "refrankenstein.firebasestorage.app",
      messagingSenderId: "575434538832",
      appId: "1:575434538832:web:615f850a61c54ddd9d3655"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Datos globales
    let inicios = [];
    let remates = [];

    // FunciÃ³n para eliminar duplicados
    function eliminarDuplicados(arr) {
      const vistos = new Set();
      return arr.filter(item => {
        const normalizado = item.toLowerCase()
          .normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim();
        return vistos.has(normalizado) ? false : vistos.add(normalizado);
      });
    }

    // Cargar datos desde Firestore
    db.collection("tradicionales").get().then((querySnapshot) => {
      const tempInicios = [];
      const tempRemates = [];
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        if(data.inicio) {
          const inicioLimpio = data.inicio.trim();
          if(inicioLimpio !== "") tempInicios.push(inicioLimpio);
        }
        if(data.remate) {
          const remateLimpio = data.remate.trim();
          if(remateLimpio !== "") tempRemates.push(remateLimpio);
        }
      });
      inicios = eliminarDuplicados(tempInicios).sort((a, b) => a.localeCompare(b, 'es'));
      remates = eliminarDuplicados(tempRemates).sort((a, b) => a.localeCompare(b, 'es'));
      console.log('Datos cargados:', { inicios, remates });
      actualizarContenido(1);
      actualizarContenido(2);
    }).catch(error => {
      console.error("Error cargando datos:", error);
      mostrarNotificacion("Error cargando datos", 5000);
    });

    // FunciÃ³n para actualizar selectores de contenido
    function actualizarContenido(parte) {
      const tipoSelector = document.getElementById(`tipo-parte-${parte}`);
      const contenidoSelector = document.getElementById(`contenido-parte-${parte}`);
      const tipo = tipoSelector.value;
      const opciones = tipo === "inicio" ? inicios : remates;
      contenidoSelector.innerHTML = opciones.map((texto, index) => 
        `<option value="${index}">${texto}</option>`
      ).join('');
      // Seleccionar el primer elemento por defecto y centrar el select
      contenidoSelector.selectedIndex = 0;
      centrarSelect(contenidoSelector);
    }

    // FunciÃ³n para generar el refrÃ¡n
    function generarRefran() {
      const tipo1 = document.getElementById('tipo-parte-1').value;
      const tipo2 = document.getElementById('tipo-parte-2').value;
      const index1 = document.getElementById('contenido-parte-1').value;
      const index2 = document.getElementById('contenido-parte-2').value;
      const parte1 = tipo1 === "inicio" ? inicios[index1] : remates[index1];
      const parte2 = tipo2 === "inicio" ? inicios[index2] : remates[index2];
      const refranCompleto = `${parte1} ${parte2}`;
      document.getElementById('resultado').textContent = refranCompleto;
      guardarRefran(refranCompleto);
    }

    // FunciÃ³n para guardar el refrÃ¡n en Firebase
    async function guardarRefran(refran) {
      try {
        await db.collection("refranes").add({
          texto: refran,
          fecha: firebase.firestore.FieldValue.serverTimestamp()
        });
        mostrarNotificacion("Â¡RefrÃ¡n guardado!", 2000);
      } catch (error) {
        console.error("Error guardando refrÃ¡n:", error);
      }
    }

    // FunciÃ³n para mostrar una notificaciÃ³n
    function mostrarNotificacion(texto, duracion = 2000) {
      const notificacion = document.getElementById('notificacion');
      notificacion.textContent = texto;
      notificacion.style.display = 'block';
      setTimeout(() => {
        notificacion.style.display = 'none';
      }, duracion);
    }

    // Control del menÃº desplegable
    document.querySelector('.menu-btn').addEventListener('click', function(e) {
      e.stopPropagation();
      const menu = document.querySelector('.menu-contenido');
      menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    });
    window.addEventListener('click', function(e) {
      if (!e.target.matches('.menu-btn') && !e.target.closest('.menu-contenido')) {
        const menu = document.querySelector('.menu-contenido');
        if (menu) menu.style.display = 'none';
      }
    });
  </script>
</body>
</html>
