<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refr√°nkenstein</title>
    <style>
        /* Tu CSS permanece igual */
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAdoPUF-cCyvpfiCJiBfCRv3ZYtwu1W4tc",
            authDomain: "refrankenstein.firebaseapp.com",
            projectId: "refrankenstein",
            storageBucket: "refrankenstein.firebasestorage.app",
            messagingSenderId: "575434538832",
            appId: "1:575434538832:web:615f850a61c54ddd9d3655"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Variables globales
        let iniciosRefran = [];
        let rematesRefran = [];

        // Cargar refranes desde Firestore
        function cargarRefranes() {
            const iniciosRef = db.collection("tradicionales").where("tipo", "==", "inicio");
            const rematesRef = db.collection("tradicionales").where("tipo", "==", "remate");

            iniciosRef.get().then(querySnapshot => {
                iniciosRefran = querySnapshot.docs.map(doc => doc.data().texto);
                rematesRef.get().then(querySnapshot => {
                    rematesRefran = querySnapshot.docs.map(doc => doc.data().texto);
                    cambiarInicio(); // Llamar a cambiarInicio despu√©s de cargar los datos
                });
            }).catch(error => {
                console.error("Error al cargar los refranes:", error);
            });
        }

        function guardarRefran(refran) {
            db.collection("refranes").add({
                texto: refran,
                fecha: new Date()
            });
        }

        function cambiarInicio() {
            if (iniciosRefran.length === 0) {
                console.error("No se encontraron refranes de inicio.");
                return;
            }

            let inicioActual = iniciosRefran[Math.floor(Math.random() * iniciosRefran.length)];
            document.getElementById('inicio-refran').textContent = inicioActual;
            generarNuevoRemate();
        }

        function generarNuevoRemate() {
            if (rematesRefran.length === 0) {
                console.error("No se encontraron refranes de remate.");
                return;
            }

            let remateActual = rematesRefran[Math.floor(Math.random() * rematesRefran.length)];
            document.getElementById('remate-card').textContent = remateActual;
        }

        function toggleLike() {
            const combination = `${document.getElementById('inicio-refran').textContent} ${document.getElementById('remate-card').textContent}`;
            const heart = document.querySelector('.heart-button');
            
            // Referencia a la colecci√≥n en Firestore
            const refranesRef = firebase.firestore().collection('refranes');
            
            if (heart.classList.contains('liked')) {
                // Eliminar de Firestore (opcional)
                refranesRef.where('texto', '==', combination).get()
                    .then(querySnapshot => {
                        querySnapshot.forEach(doc => {
                            doc.ref.delete();
                        });
                    });
                heart.classList.remove('liked');
                showToast("Refr√°nkenstein eliminado‚ùå");
            } else {
                // Guardar en Firestore
                refranesRef.add({
                    texto: combination,
                    fecha: firebase.firestore.FieldValue.serverTimestamp(),
                    votos: 0
                })
                .then(() => {
                    heart.classList.add('liked');
                    showToast("Refr√°nkenstein guardado‚úî");
                })
                .catch(error => {
                    console.error("Error al guardar:", error);
                    alert("Error al guardar. Revisa la consola.");
                });
            }
        }

        function showToast(message, duration = 3000) {
            const toast = document.getElementById('custom-toast');
            document.getElementById('toast-message').textContent = message;
            
            toast.classList.add('toast-visible');
            setTimeout(() => {
                toast.classList.remove('toast-visible');
            }, duration);
        }

        // Inicializaci√≥n
        cargarRefranes(); // Cargar los refranes al cargar la p√°gina
    </script>
</head>
<body>
    <!-- Tu HTML permanece igual -->
    <div class="title-container">
        <h1>Refr√°nkenstein</h1>
    </div>

    <div class="inicio-container">
        <button class="change-inicio" onclick="cambiarInicio()">‚Üª</button>
        <div id="inicio-refran" class="inicio-texto"></div>
    </div>

    <div class="swipe-container">
        <button class="nav-arrow prev" onclick="previousRemate()">‚ùÆ</button>
        <button class="nav-arrow next" onclick="nextRemate()">‚ùØ</button>
        <div class="remate-card" id="remate-card"></div>
    </div>

    <button class="heart-button" onclick="toggleLike()">‚ù§</button>

    <a href="publicos.html" class="floating-button">
        üìú Refr√°nkensteins creados‚Üí
    </a>

    <style>
        .floating-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2c3e50;
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            text-decoration: none;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
    </style>
</body>
</html>
